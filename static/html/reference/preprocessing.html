

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Preprocessing &mdash; scikit-mobility  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Measures" href="measures.html" />
    <link rel="prev" title="Data Structures" href="data_structures.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="../index.html" class="icon icon-home"> scikit-mobility
          

          
            
            <img src="../_static/logo_skmob.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">API Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data_structures.html">Data Structures</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="measures.html">Measures</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="io.html">Input/Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="privacy.html">Privacy</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">scikit-mobility</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Preprocessing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/reference/preprocessing.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="preprocessing">
<h1>Preprocessing<a class="headerlink" href="#preprocessing" title="Permalink to this headline">¶</a></h1>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#skmob.preprocessing.filtering.filter" title="skmob.preprocessing.filtering.filter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">filtering.filter</span></code></a>(tdf[, max_speed_kmh, …])</p></td>
<td><p>Trajectory filtering.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#skmob.preprocessing.compression.compress" title="skmob.preprocessing.compression.compress"><code class="xref py py-obj docutils literal notranslate"><span class="pre">compression.compress</span></code></a>(tdf[, spatial_radius_km])</p></td>
<td><p>Trajectory compression.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#skmob.preprocessing.detection.stops" title="skmob.preprocessing.detection.stops"><code class="xref py py-obj docutils literal notranslate"><span class="pre">detection.stops</span></code></a>(tdf[, stop_radius_factor, …])</p></td>
<td><p>Stops detection.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#skmob.preprocessing.clustering.cluster" title="skmob.preprocessing.clustering.cluster"><code class="xref py py-obj docutils literal notranslate"><span class="pre">clustering.cluster</span></code></a>(tdf[, cluster_radius_km, …])</p></td>
<td><p>Clustering of locations.</p></td>
</tr>
</tbody>
</table>
<dl class="py function">
<dt class="sig sig-object py" id="skmob.preprocessing.filtering.filter">
<span class="sig-prename descclassname"><span class="pre">skmob.preprocessing.filtering.</span></span><span class="sig-name descname"><span class="pre">filter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tdf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_speed_kmh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">500.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_loops</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">speed_kmh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_loop</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ratio_max</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.25</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.preprocessing.filtering.filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Trajectory filtering.</p>
<p>For each individual in a TrajDataFrame, filter out the trajectory points that are considered noise or outliers <a class="reference internal" href="#id6" id="id1"><span>[Z2015]</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tdf</strong> (<em>TrajDataFrame</em>) – the trajectories of the individuals.</p></li>
<li><p><strong>max_speed_kmh</strong> (<em>float, optional</em>) – delete a trajectory point if the speed (in km/h) from the previous point is higher than <cite>max_speed_kmh</cite>. The default is <cite>500.0</cite>.</p></li>
<li><p><strong>include_loops</strong> (<em>boolean, optional</em>) – If <cite>True</cite>, trajectory points belonging to short and fast “loops” are removed. Specifically, points are removed if within the next <cite>max_loop</cite> points the individual has come back to a distance (<cite>ratio_max</cite> * the maximum distance reached), AND the average speed (in km/h) is higher than <cite>speed</cite>. The default is <cite>False</cite>.</p></li>
<li><p><strong>speed</strong> (<em>float, optional</em>) – the default is 5km/h (walking speed).</p></li>
<li><p><strong>max_loop</strong> (<em>int, optional</em>) – the default is <cite>6</cite>.</p></li>
<li><p><strong>ratio_max</strong> (<em>float, optional</em>) – the default is <cite>0.25</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the TrajDataFrame without the trajectory points that have been filtered out.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="data_structures.html#skmob.core.trajectorydataframe.TrajDataFrame" title="skmob.core.trajectorydataframe.TrajDataFrame">TrajDataFrame</a></p>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>if <cite>include_loops</cite> is <cite>True</cite>, the filter is very slow. Use only if raw data is really noisy.</p>
</div>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">skmob</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.preprocessing</span> <span class="kn">import</span> <span class="n">filtering</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># read the trajectory data (GeoLife)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="n">skmob</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">GEOLIFE_SAMPLE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tdf</span> <span class="o">=</span> <span class="n">skmob</span><span class="o">.</span><span class="n">TrajDataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">tdf</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">         lat         lng            datetime  uid</span>
<span class="go">0  39.984094  116.319236 2008-10-23 05:53:05    1</span>
<span class="go">1  39.984198  116.319322 2008-10-23 05:53:06    1</span>
<span class="go">2  39.984224  116.319402 2008-10-23 05:53:11    1</span>
<span class="go">3  39.984211  116.319389 2008-10-23 05:53:16    1</span>
<span class="go">4  39.984217  116.319422 2008-10-23 05:53:21    1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># filter out all points with a speed (in km/h) from the previous point higher than 500 km/h</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ftdf</span> <span class="o">=</span> <span class="n">filtering</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">tdf</span><span class="p">,</span> <span class="n">max_speed_kmh</span><span class="o">=</span><span class="mf">500.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ftdf</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
<span class="go">{&#39;filter&#39;: {&#39;function&#39;: &#39;filter&#39;, &#39;max_speed_kmh&#39;: 500.0, &#39;include_loops&#39;: False, &#39;speed_kmh&#39;: 5.0, &#39;max_loop&#39;: 6, &#39;ratio_max&#39;: 0.25}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n_deleted_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tdf</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">ftdf</span><span class="p">)</span> <span class="c1"># number of deleted points</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">n_deleted_points</span><span class="p">)</span>
<span class="go">54</span>
</pre></div>
</div>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="z2015"><span class="brackets">Z2015</span></dt>
<dd><p>Zheng, Y. (2015) Trajectory data mining: an overview. ACM Transactions on Intelligent Systems and Technology 6(3), <a class="reference external" href="https://dl.acm.org/citation.cfm?id=2743025">https://dl.acm.org/citation.cfm?id=2743025</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skmob.preprocessing.compression.compress">
<span class="sig-prename descclassname"><span class="pre">skmob.preprocessing.compression.</span></span><span class="sig-name descname"><span class="pre">compress</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tdf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spatial_radius_km</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.preprocessing.compression.compress" title="Permalink to this definition">¶</a></dt>
<dd><p>Trajectory compression.</p>
<p>Reduce the number of points in a trajectory for each individual in a TrajDataFrame. All points within a radius of <cite>spatial_radius_km</cite> kilometers from a given initial point are compressed into a single point that has the median coordinates of all points and the time of the initial point <a class="reference internal" href="#id6" id="id2"><span>[Z2015]</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tdf</strong> (<em>TrajDataFrame</em>) – the input trajectories of the individuals.</p></li>
<li><p><strong>spatial_radius_km</strong> (<em>float, optional</em>) – the minimum distance (in km) between consecutive points of the compressed trajectory. The default is <cite>0.2</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the compressed TrajDataFrame.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="data_structures.html#skmob.core.trajectorydataframe.TrajDataFrame" title="skmob.core.trajectorydataframe.TrajDataFrame">TrajDataFrame</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">skmob</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.preprocessing</span> <span class="kn">import</span> <span class="n">compression</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># read the trajectory data (GeoLife)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="n">skmob</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">GEOLIFE_SAMPLE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tdf</span> <span class="o">=</span> <span class="n">skmob</span><span class="o">.</span><span class="n">TrajDataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">tdf</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">         lat         lng            datetime  uid</span>
<span class="go">0  39.984094  116.319236 2008-10-23 05:53:05    1</span>
<span class="go">1  39.984198  116.319322 2008-10-23 05:53:06    1</span>
<span class="go">2  39.984224  116.319402 2008-10-23 05:53:11    1</span>
<span class="go">3  39.984211  116.319389 2008-10-23 05:53:16    1</span>
<span class="go">4  39.984217  116.319422 2008-10-23 05:53:21    1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># compress the trajectory using a spatial radius of 0.2 km</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ctdf</span> <span class="o">=</span> <span class="n">compression</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">tdf</span><span class="p">,</span> <span class="n">spatial_radius_km</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Points of the original trajectory:</span><span class="se">\t</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">tdf</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Points of the compressed trajectory:</span><span class="se">\t</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">ctdf</span><span class="p">))</span>
<span class="go">Points of the original trajectory:  217653</span>
<span class="go">Points of the compressed trajectory:        6281</span>
</pre></div>
</div>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="id3"><span class="brackets">Z2015</span></dt>
<dd><p>Zheng, Y. (2015) Trajectory data mining: an overview. ACM Transactions on Intelligent Systems and Technology 6(3), <a class="reference external" href="https://dl.acm.org/citation.cfm?id=2743025">https://dl.acm.org/citation.cfm?id=2743025</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skmob.preprocessing.detection.stops">
<span class="sig-prename descclassname"><span class="pre">skmob.preprocessing.detection.</span></span><span class="sig-name descname"><span class="pre">stops</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tdf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stop_radius_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minutes_for_a_stop</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spatial_radius_km</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">leaving_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">no_data_for_minutes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000000000000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_speed_kmh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.preprocessing.detection.stops" title="Permalink to this definition">¶</a></dt>
<dd><p>Stops detection.</p>
<p>Detect the stops for each individual in a TrajDataFrame. A stop is detected when the individual spends at least <cite>minutes_for_a_stop</cite> minutes within a distance <cite>stop_radius_factor * spatial_radius</cite> km from a given trajectory point. The stop’s coordinates are the median latitude and longitude values of the points found within the specified distance <a class="reference internal" href="#id9" id="id4"><span>[RT2004]</span></a> <a class="reference internal" href="#id6" id="id5"><span>[Z2015]</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tdf</strong> (<em>TrajDataFrame</em>) – the input trajectories of the individuals.</p></li>
<li><p><strong>stop_radius_factor</strong> (<em>float, optional</em>) – if argument <cite>spatial_radius_km</cite> is <cite>None</cite>, the spatial_radius used is the value specified in the TrajDataFrame properties (“spatial_radius_km” assigned by a <cite>preprocessing.compression</cite> function) multiplied by this argument, <cite>stop_radius_factor</cite>. The default is <cite>0.5</cite>.</p></li>
<li><p><strong>minutes_for_a_stop</strong> (<em>float, optional</em>) – the minimum stop duration, in minutes. The default is <cite>20.0</cite>.</p></li>
<li><p><strong>spatial_radius_km</strong> (<em>float or None, optional</em>) – the radius of the ball enclosing all trajectory points within the stop location. The default is <cite>0.2</cite>.</p></li>
<li><p><strong>leaving_time</strong> (<em>boolean, optional</em>) – if <cite>True</cite>, a new column ‘leaving_datetime’ is added with the departure time from the stop location. The default is <cite>True</cite>.</p></li>
<li><p><strong>no_data_for_minutes</strong> (<em>float, optional</em>) – if the number of minutes between two consecutive points is larger than <cite>no_data_for_minutes</cite>,
then this is interpreted as missing data and does not count as a stop. The default is <cite>1e12</cite>.</p></li>
<li><p><strong>min_speed_kmh</strong> (<em>float or None, optional</em>) – if not <cite>None</cite>, remove the points at the end of a stop if their speed is larger than <cite>min_speed_kmh</cite> km/h. The default is <cite>None</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a TrajDataFrame with the coordinates (latitude, longitude) of the stop locations.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="data_structures.html#skmob.core.trajectorydataframe.TrajDataFrame" title="skmob.core.trajectorydataframe.TrajDataFrame">TrajDataFrame</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">skmob</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.preprocessing</span> <span class="kn">import</span> <span class="n">detection</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># read the trajectory data (GeoLife)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="n">skmob</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">GEOLIFE_SAMPLE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tdf</span> <span class="o">=</span> <span class="n">skmob</span><span class="o">.</span><span class="n">TrajDataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">tdf</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">         lat         lng            datetime  uid</span>
<span class="go">0  39.984094  116.319236 2008-10-23 05:53:05    1</span>
<span class="go">1  39.984198  116.319322 2008-10-23 05:53:06    1</span>
<span class="go">2  39.984224  116.319402 2008-10-23 05:53:11    1</span>
<span class="go">3  39.984211  116.319389 2008-10-23 05:53:16    1</span>
<span class="go">4  39.984217  116.319422 2008-10-23 05:53:21    1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stdf</span> <span class="o">=</span> <span class="n">detection</span><span class="o">.</span><span class="n">stops</span><span class="p">(</span><span class="n">tdf</span><span class="p">,</span> <span class="n">stop_radius_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">minutes_for_a_stop</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">spatial_radius_km</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">leaving_time</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stdf</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">         lat         lng            datetime  uid    leaving_datetime</span>
<span class="go">0  39.978030  116.327481 2008-10-23 06:01:37    1 2008-10-23 10:32:53</span>
<span class="go">1  40.013820  116.306532 2008-10-23 11:10:19    1 2008-10-23 23:45:27</span>
<span class="go">2  39.978419  116.326870 2008-10-24 00:21:52    1 2008-10-24 01:47:30</span>
<span class="go">3  39.981166  116.308475 2008-10-24 02:02:31    1 2008-10-24 02:30:29</span>
<span class="go">4  39.981431  116.309902 2008-10-24 02:30:29    1 2008-10-24 03:16:35</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stdf</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
<span class="go">{&#39;detect&#39;: {&#39;function&#39;: &#39;stops&#39;, &#39;stop_radius_factor&#39;: 0.5, &#39;minutes_for_a_stop&#39;: 20.0, &#39;spatial_radius_km&#39;: 0.2, &#39;leaving_time&#39;: True, &#39;no_data_for_minutes&#39;: 1000000000000.0, &#39;min_speed_kmh&#39;: None}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Points of the original trajectory:</span><span class="se">\t</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">tdf</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Points of stops:</span><span class="se">\t\t\t</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">stdf</span><span class="p">))</span>
<span class="go">Points of the original trajectory:  217653</span>
<span class="go">Points of stops:                    391</span>
</pre></div>
</div>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="rt2004"><span class="brackets">RT2004</span></dt>
<dd><p>Ramaswamy, H. &amp; Toyama, K. (2004) Project Lachesis: parsing and modeling location histories. In International Conference on Geographic Information Science, 106-124, <a class="reference external" href="http://kentarotoyama.com/papers/Hariharan_2004_Project_Lachesis.pdf">http://kentarotoyama.com/papers/Hariharan_2004_Project_Lachesis.pdf</a></p>
</dd>
<dt class="label" id="id6"><span class="brackets">Z2015</span></dt>
<dd><p>Zheng, Y. (2015) Trajectory data mining: an overview. ACM Transactions on Intelligent Systems and Technology 6(3), <a class="reference external" href="https://dl.acm.org/citation.cfm?id=2743025">https://dl.acm.org/citation.cfm?id=2743025</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skmob.preprocessing.clustering.cluster">
<span class="sig-prename descclassname"><span class="pre">skmob.preprocessing.clustering.</span></span><span class="sig-name descname"><span class="pre">cluster</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tdf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_radius_km</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_samples</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.preprocessing.clustering.cluster" title="Permalink to this definition">¶</a></dt>
<dd><p>Clustering of locations.</p>
<p>Cluster the stops of each individual in a TrajDataFrame. The stops correspond to visits to the same location at different times, based on spatial proximity <a class="reference internal" href="#id9" id="id7"><span>[RT2004]</span></a>. The clustering algorithm used is DBSCAN (by sklearn <a class="reference internal" href="#dbscan" id="id8"><span>[DBSCAN]</span></a>).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tdf</strong> (<em>TrajDataFrame</em>) – the input TrajDataFrame that should contain the stops, i.e., the output of a <cite>preprocessing.detection</cite> function.</p></li>
<li><p><strong>cluster_radius_km</strong> (<em>float, optional</em>) – the parameter <cite>eps</cite> of the function sklearn.cluster.DBSCAN, in kilometers. The default is <cite>0.1</cite>.</p></li>
<li><p><strong>min_samples</strong> (<em>int, optional</em>) – the parameter <cite>min_samples</cite> of the function sklearn.cluster.DBSCAN indicating the minimum number of stops to form a cluster. The default is <cite>1</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a TrajDataFrame with the additional column ‘cluster’ containing the cluster labels. The stops that belong to the same cluster have the same label. The labels are integers corresponding to the ranks of clusters according to the frequency of visitation (the most visited cluster has label 0, the second most visited has label 1, etc.).</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="data_structures.html#skmob.core.trajectorydataframe.TrajDataFrame" title="skmob.core.trajectorydataframe.TrajDataFrame">TrajDataFrame</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">skmob</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.preprocessing</span> <span class="kn">import</span> <span class="n">detection</span><span class="p">,</span> <span class="n">clustering</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># read the trajectory data (GeoLife)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="n">skmob</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">GEOLIFE_SAMPLE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tdf</span> <span class="o">=</span> <span class="n">skmob</span><span class="o">.</span><span class="n">TrajDataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">tdf</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">         lat         lng            datetime  uid</span>
<span class="go">0  39.984094  116.319236 2008-10-23 05:53:05    1</span>
<span class="go">1  39.984198  116.319322 2008-10-23 05:53:06    1</span>
<span class="go">2  39.984224  116.319402 2008-10-23 05:53:11    1</span>
<span class="go">3  39.984211  116.319389 2008-10-23 05:53:16    1</span>
<span class="go">4  39.984217  116.319422 2008-10-23 05:53:21    1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># detect the stops first</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stdf</span> <span class="o">=</span> <span class="n">detection</span><span class="o">.</span><span class="n">stops</span><span class="p">(</span><span class="n">tdf</span><span class="p">,</span> <span class="n">stop_radius_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">minutes_for_a_stop</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">spatial_radius_km</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">leaving_time</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># cluster the stops</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cstdf</span> <span class="o">=</span> <span class="n">clustering</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">stdf</span><span class="p">,</span> <span class="n">cluster_radius_km</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cstdf</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">         lat         lng            datetime  uid    leaving_datetime  cluster</span>
<span class="go">0  39.978030  116.327481 2008-10-23 06:01:37    1 2008-10-23 10:32:53        0</span>
<span class="go">1  40.013820  116.306532 2008-10-23 11:10:19    1 2008-10-23 23:45:27        1</span>
<span class="go">2  39.978419  116.326870 2008-10-24 00:21:52    1 2008-10-24 01:47:30        0</span>
<span class="go">3  39.981166  116.308475 2008-10-24 02:02:31    1 2008-10-24 02:30:29       42</span>
<span class="go">4  39.981431  116.309902 2008-10-24 02:30:29    1 2008-10-24 03:16:35       41</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cstdf</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
<span class="go">{&#39;detect&#39;: {&#39;function&#39;: &#39;stops&#39;, &#39;stop_radius_factor&#39;: 0.5, &#39;minutes_for_a_stop&#39;: 20.0, &#39;spatial_radius_km&#39;: 0.2, &#39;leaving_time&#39;: True, &#39;no_data_for_minutes&#39;: 1000000000000.0, &#39;min_speed_kmh&#39;: None}, &#39;cluster&#39;: {&#39;function&#39;: &#39;cluster&#39;, &#39;cluster_radius_km&#39;: 0.1, &#39;min_samples&#39;: 1}}</span>
</pre></div>
</div>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="dbscan"><span class="brackets"><a class="fn-backref" href="#id8">DBSCAN</a></span></dt>
<dd><p>DBSCAN implementation, scikit-learn, <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.DBSCAN.html">https://scikit-learn.org/stable/modules/generated/sklearn.cluster.DBSCAN.html</a></p>
</dd>
<dt class="label" id="id9"><span class="brackets">RT2004</span></dt>
<dd><p>Ramaswamy, H. &amp; Toyama, K. (2004) Project Lachesis: parsing and modeling location histories. In International Conference on Geographic Information Science, 106-124, <a class="reference external" href="http://kentarotoyama.com/papers/Hariharan_2004_Project_Lachesis.pdf">http://kentarotoyama.com/papers/Hariharan_2004_Project_Lachesis.pdf</a></p>
</dd>
</dl>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="measures.html" class="btn btn-neutral float-right" title="Measures" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="data_structures.html" class="btn btn-neutral float-left" title="Data Structures" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019, skmob devs.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>