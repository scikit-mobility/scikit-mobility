

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Models &mdash; scikit-mobility  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Input/Output" href="io.html" />
    <link rel="prev" title="Evaluation measures" href="evaluation_measures.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="../index.html" class="icon icon-home"> scikit-mobility
          

          
            
            <img src="../_static/logo_skmob.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">API Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data_structures.html">Data Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessing.html">Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="measures.html">Measures</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-skmob.models.epr">EPR</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-skmob.models.markov_diary_generator">Markov Diary Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-skmob.models.gravity">Gravity</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-skmob.models.radiation">Radiation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="io.html">Input/Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="privacy.html">Privacy</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">scikit-mobility</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Models</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/reference/models.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="models">
<h1>Models<a class="headerlink" href="#models" title="Permalink to this headline">¶</a></h1>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#skmob.models.epr.DensityEPR" title="skmob.models.epr.DensityEPR"><code class="xref py py-obj docutils literal notranslate"><span class="pre">epr.DensityEPR</span></code></a>([name, rho, gamma, beta, …])</p></td>
<td><p>Density-EPR model.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#skmob.models.epr.SpatialEPR" title="skmob.models.epr.SpatialEPR"><code class="xref py py-obj docutils literal notranslate"><span class="pre">epr.SpatialEPR</span></code></a>([name, rho, gamma, beta, …])</p></td>
<td><p>Spatial-EPR model.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#skmob.models.epr.Ditras" title="skmob.models.epr.Ditras"><code class="xref py py-obj docutils literal notranslate"><span class="pre">epr.Ditras</span></code></a>(diary_generator[, name, rho, gamma])</p></td>
<td><p>Ditras modelling framework.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#skmob.models.markov_diary_generator.MarkovDiaryGenerator" title="skmob.models.markov_diary_generator.MarkovDiaryGenerator"><code class="xref py py-obj docutils literal notranslate"><span class="pre">markov_diary_generator.MarkovDiaryGenerator</span></code></a>([name])</p></td>
<td><p>Markov Diary Learner and Generator.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#skmob.models.gravity.Gravity" title="skmob.models.gravity.Gravity"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gravity.Gravity</span></code></a>([deterrence_func_type, …])</p></td>
<td><p>Gravity model.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#skmob.models.radiation.Radiation" title="skmob.models.radiation.Radiation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">radiation.Radiation</span></code></a>([name])</p></td>
<td><p>Radiation model.</p></td>
</tr>
</tbody>
</table>
<div class="section" id="module-skmob.models.epr">
<span id="epr"></span><h2>EPR<a class="headerlink" href="#module-skmob.models.epr" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="skmob.models.epr.DensityEPR">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">skmob.models.epr.</span></span><span class="sig-name descname"><span class="pre">DensityEPR</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Density</span> <span class="pre">EPR</span> <span class="pre">model'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rho</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.21</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">17</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_wait_time_minutes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.epr.DensityEPR" title="Permalink to this definition">¶</a></dt>
<dd><p>Density-EPR model.</p>
<p>The d-EPR model of individual human mobility consists of the following mechanisms <a class="reference internal" href="#psrpgb2015" id="id1"><span>[PSRPGB2015]</span></a> <a class="reference internal" href="#psr2016" id="id2"><span>[PSR2016]</span></a>:</p>
<p><strong>Waiting time choice</strong>. The waiting time <span class="math notranslate nohighlight">\(\Delta t\)</span> between two movements of the agent is chosen randomly from the distribution <span class="math notranslate nohighlight">\(P(\Delta t) \sim \Delta t^{−1 −\beta} \exp(−\Delta t/ \tau)\)</span>. Parameters <span class="math notranslate nohighlight">\(\beta\)</span> and <span class="math notranslate nohighlight">\(\tau\)</span> correspond to arguments <cite>beta</cite> and <cite>tau</cite> of the constructor, respectively.</p>
<p><strong>Action selection</strong>. With probability <span class="math notranslate nohighlight">\(P_{new}=\rho S^{-\gamma}\)</span>, where <span class="math notranslate nohighlight">\(S\)</span> is the number of distinct locations previously visited by the agent, the agent visits a new location (Exploration phase), otherwise it returns to a previously visited location (Return phase). Parameters <span class="math notranslate nohighlight">\(\rho\)</span> and <span class="math notranslate nohighlight">\(\gamma\)</span> correspond to arguments <cite>rho</cite> and <cite>gamma</cite> of the constructor, respectively.</p>
<p><strong>Exploration phase</strong>. If the agent that is currently in location <span class="math notranslate nohighlight">\(i\)</span> explores a new location, then the new location <span class="math notranslate nohighlight">\(j \neq i\)</span> is selected according to the gravity model with probability <span class="math notranslate nohighlight">\(p_{ij} = \frac{1}{N} \frac{n_i n_j}{r_{ij}^2}\)</span>, where <span class="math notranslate nohighlight">\(n_{i (j)}\)</span> is the location’s relevance, that is, the probability of a population to visit location <span class="math notranslate nohighlight">\(i(j)\)</span>, <span class="math notranslate nohighlight">\(r_{ij}\)</span> is the geographic distance between <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span>, and <span class="math notranslate nohighlight">\(N = \sum_{i, j \neq i} p_{ij}\)</span> is a normalization constant. The number of distinct locations visited, <span class="math notranslate nohighlight">\(S\)</span>, is increased by 1.</p>
<p><strong>Return phase</strong>. If the individual returns to a previously visited location, such a location <span class="math notranslate nohighlight">\(i\)</span> is chosen with probability proportional to the number of time the agent visited <span class="math notranslate nohighlight">\(i\)</span>, i.e., <span class="math notranslate nohighlight">\(\Pi_i = f_i\)</span>, where <span class="math notranslate nohighlight">\(f_i\)</span> is the visitation frequency of location <span class="math notranslate nohighlight">\(i\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>str, optional</em>) – the name of the instantiation of the d-EPR model. The default value is “Density EPR model”.</p></li>
<li><p><strong>rho</strong> (<em>float, optional</em>) – it corresponds to the parameter <span class="math notranslate nohighlight">\(\rho \in (0, 1]\)</span> in the Action selection mechanism <span class="math notranslate nohighlight">\(P_{new} = \rho S^{-\gamma}\)</span> and controls the agent’s tendency to explore a new location during the next move versus returning to a previously visited location. The default value is <span class="math notranslate nohighlight">\(\rho = 0.6\)</span> <a class="reference internal" href="#skwb2010" id="id3"><span>[SKWB2010]</span></a>.</p></li>
<li><p><strong>gamma</strong> (<em>float, optional</em>) – it corresponds to the parameter <span class="math notranslate nohighlight">\(\gamma\)</span> (<span class="math notranslate nohighlight">\(\gamma \geq 0\)</span>) in the Action selection mechanism <span class="math notranslate nohighlight">\(P_{new} = \rho S^{-\gamma}\)</span> and controls the agent’s tendency to explore a new location during the next move versus returning to a previously visited location. The default value is <span class="math notranslate nohighlight">\(\gamma=0.21\)</span> <a class="reference internal" href="#skwb2010" id="id4"><span>[SKWB2010]</span></a>.</p></li>
<li><p><strong>beta</strong> (<em>float, optional</em>) – it corresponds to the parameter <span class="math notranslate nohighlight">\(\beta\)</span> of the waiting time distribution in the Waiting time choice mechanism. The default value is <span class="math notranslate nohighlight">\(\beta=0.8\)</span> <a class="reference internal" href="#skwb2010" id="id5"><span>[SKWB2010]</span></a>.</p></li>
<li><p><strong>tau</strong> (<em>int, optional</em>) – it corresponds to the parameter <span class="math notranslate nohighlight">\(\tau\)</span> of the waiting time distribution in the Waiting time choice mechanism. The default value is <span class="math notranslate nohighlight">\(\tau = 17\)</span>, expressed in hours <a class="reference internal" href="#skwb2010" id="id6"><span>[SKWB2010]</span></a>.</p></li>
<li><p><strong>min_wait_time_minutes</strong> (<em>int</em>) – minimum waiting time between two movements, in minutes.</p></li>
</ul>
</dd>
<dt class="field-even">Variables</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – the name of the instantiation of the model.</p></li>
<li><p><strong>rho</strong> (<em>float</em>) – the input parameter <span class="math notranslate nohighlight">\(\rho\)</span>.</p></li>
<li><p><strong>gamma</strong> (<em>float</em>) – the input parameters <span class="math notranslate nohighlight">\(\gamma\)</span>.</p></li>
<li><p><strong>beta</strong> (<em>float</em>) – the input parameter <span class="math notranslate nohighlight">\(\beta\)</span>.</p></li>
<li><p><strong>tau</strong> (<em>int</em>) – the input parameter <span class="math notranslate nohighlight">\(\tau\)</span>.</p></li>
<li><p><strong>min_wait_time_minutes</strong> (<em>int</em>) – the input parameters <cite>min_wait_time_minutes</cite>.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">skmob</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.models.epr</span> <span class="kn">import</span> <span class="n">DensityEPR</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">url</span> <span class="o">=</span> <span class="n">skmob</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">NY_COUNTIES_2011</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tessellation</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">start_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2019/01/01 08:00:00&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">end_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2019/01/14 08:00:00&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">depr</span> <span class="o">=</span> <span class="n">DensityEPR</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tdf</span> <span class="o">=</span> <span class="n">depr</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">tessellation</span><span class="p">,</span> <span class="n">relevance_column</span><span class="o">=</span><span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="n">n_agents</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">tdf</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">   uid                   datetime        lat        lng</span>
<span class="go">0    1 2019-01-01 08:00:00.000000  42.780819 -76.823724</span>
<span class="go">1    1 2019-01-01 09:45:58.388540  42.728060 -77.775510</span>
<span class="go">2    1 2019-01-01 10:16:09.406408  42.780819 -76.823724</span>
<span class="go">3    1 2019-01-01 17:13:39.999037  42.852827 -77.299810</span>
<span class="go">4    1 2019-01-01 19:24:27.353379  42.728060 -77.775510</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">tdf</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
<span class="go">{&#39;model&#39;: {&#39;class&#39;: &lt;function DensityEPR.__init__ at 0x7f548a49cf28&gt;, &#39;generate&#39;: {&#39;start_date&#39;: Timestamp(&#39;2019-01-01 08:00:00&#39;), &#39;end_date&#39;: Timestamp(&#39;2019-01-14 08:00:00&#39;), &#39;gravity_singly&#39;: {}, &#39;n_agents&#39;: 100, &#39;relevance_column&#39;: &#39;population&#39;, &#39;random_state&#39;: None, &#39;show_progress&#39;: True}}}</span>
</pre></div>
</div>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="psrpgb2015"><span class="brackets">PSRPGB2015</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id11">2</a>)</span></dt>
<dd><p>Pappalardo, L., Simini, F. Rinzivillo, S., Pedreschi, D. Giannotti, F. &amp; Barabasi, A. L. (2015) Returners and Explorers dichotomy in human mobility. Nature Communications 6, <a class="reference external" href="https://www.nature.com/articles/ncomms9166">https://www.nature.com/articles/ncomms9166</a></p>
</dd>
<dt class="label" id="psr2016"><span class="brackets">PSR2016</span><span class="fn-backref">(<a href="#id2">1</a>,<a href="#id12">2</a>)</span></dt>
<dd><p>Pappalardo, L., Simini, F. Rinzivillo, S. (2016) Human Mobility Modelling: exploration and preferential return meet the gravity model. Procedia Computer Science 83, <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S1877050916302216">https://www.sciencedirect.com/science/article/pii/S1877050916302216</a></p>
</dd>
<dt class="label" id="skwb2010"><span class="brackets">SKWB2010</span><span class="fn-backref">(<a href="#id3">1</a>,<a href="#id4">2</a>,<a href="#id5">3</a>,<a href="#id6">4</a>,<a href="#id8">5</a>,<a href="#id9">6</a>,<a href="#id13">7</a>,<a href="#id14">8</a>,<a href="#id15">9</a>,<a href="#id16">10</a>,<a href="#id17">11</a>,<a href="#id18">12</a>)</span></dt>
<dd><p>Song, C., Koren, T., Wang, P. &amp; Barabasi, A.L. (2010) Modelling the scaling properties of human mobility. Nature Physics 6, 818-823, <a class="reference external" href="https://www.nature.com/articles/nphys1760">https://www.nature.com/articles/nphys1760</a></p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">EPR</span></code>, <a class="reference internal" href="#skmob.models.epr.SpatialEPR" title="skmob.models.epr.SpatialEPR"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SpatialEPR</span></code></a>, <a class="reference internal" href="#skmob.models.epr.Ditras" title="skmob.models.epr.Ditras"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Ditras</span></code></a></p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="skmob.models.epr.DensityEPR.generate">
<span class="sig-name descname"><span class="pre">generate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spatial_tessellation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gravity_singly</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_agents</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">starting_locations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">od_matrix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">relevance_column</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'relevance'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_progress</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.epr.DensityEPR.generate" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the simulation of a set of agents at time <cite>start_date</cite> till time <cite>end_date</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_date</strong> (<em>datetime</em>) – the starting date of the simulation, in “YYY/mm/dd HH:MM:SS” format.</p></li>
<li><p><strong>end_date</strong> (<em>datetime</em>) – the ending date of the simulation, in “YYY/mm/dd HH:MM:SS” format.</p></li>
<li><p><strong>spatial_tessellation</strong> (<em>geopandas GeoDataFrame</em>) – the spatial tessellation, i.e., a division of the territory in locations.</p></li>
<li><p><strong>gravity_singly</strong> (<em>{} or Gravity, optional</em>) – the gravity model (singly constrained) to use when generating the probability to move between two locations (note, used by DensityEPR). The default is “{}”.</p></li>
<li><p><strong>n_agents</strong> (<em>int, optional</em>) – the number of agents to generate. The default is 1.</p></li>
<li><p><strong>relevance_column</strong> (<em>str, optional</em>) – the name of the column in <cite>spatial_tessellation</cite> to use as relevance variable. The default is “relevance”.</p></li>
<li><p><strong>starting_locations</strong> (<em>list or None, optional</em>) – a list of integers, each identifying the location from which to start the simulation of each agent. Note that, if <cite>starting_locations</cite> is not None, its length must be equal to the value of <cite>n_agents</cite>, i.e., you must specify one starting location per agent. The default is None.</p></li>
<li><p><strong>od_matrix</strong> (<em>numpy array or None, optional</em>) – the origin destination matrix to use for deciding the movements of the agent (element [i,j] is the probability of one trip from location with tessellation index i to j, normalized by origin location). If <cite>None</cite>, it is computed “on the fly” during the simulation. The default is None.</p></li>
<li><p><strong>random_state</strong> (<em>int or None, optional</em>) – if int, it is the seed used by the random number generator; if None, the random number generator is the RandomState instance used by np.random and random.random. The default is None.</p></li>
<li><p><strong>log_file</strong> (<em>str or None, optional</em>) – the name of the file where to write a log of the execution of the model. The logfile will contain all decisions (returns or explorations) made by the model. The default is None.</p></li>
<li><p><strong>show_progress</strong> (<em>boolean, optional</em>) – if True, show a progress bar. The default is False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the synthetic trajectories generated by the model</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="data_structures.html#skmob.core.trajectorydataframe.TrajDataFrame" title="skmob.core.trajectorydataframe.TrajDataFrame">TrajDataFrame</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="skmob.models.epr.Ditras">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">skmob.models.epr.</span></span><span class="sig-name descname"><span class="pre">Ditras</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">diary_generator</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Ditras</span> <span class="pre">model'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rho</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.21</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.epr.Ditras" title="Permalink to this definition">¶</a></dt>
<dd><p>Ditras modelling framework.</p>
<p>The DITRAS (DIary-based TRAjectory Simulator) modelling framework to simulate the spatio-temporal patterns of human mobility <a class="reference internal" href="#id21" id="id7"><span>[PS2018]</span></a>. DITRAS consists of two phases:</p>
<p><strong>Mobility Diary Generation</strong>. In the first phase, DITRAS generates a <em>mobility diary</em> which captures the temporal patterns of human mobility.</p>
<p><strong>Trajectory Generation</strong>. In the second phase, DITRAS transforms the mobility diary into a mobility trajectory which captures the spatial patterns of human movements.</p>
<img alt="https://raw.githubusercontent.com/jonpappalord/DITRAS/master/DITRAS_schema.png" src="https://raw.githubusercontent.com/jonpappalord/DITRAS/master/DITRAS_schema.png" />
<p><strong>Outline of the DITRAS framework</strong>. DITRAS combines two probabilistic models: a diary generator (e.g., <span class="math notranslate nohighlight">\(MD(t)\)</span>) and trajectory generator (e.g., d-EPR). The diary generator produces a mobility diary <span class="math notranslate nohighlight">\(D\)</span>. The mobility diary <span class="math notranslate nohighlight">\(D\)</span> is the input of the trajectory generator together with a weighted spatial tessellation of the territory <span class="math notranslate nohighlight">\(L\)</span>. From <span class="math notranslate nohighlight">\(D\)</span> and <span class="math notranslate nohighlight">\(L\)</span> the trajectory generator produces a synthetic mobility trajectory <span class="math notranslate nohighlight">\(S\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>diary_generator</strong> (<em>MarkovDiaryGenerator</em>) – the diary generator to use for generating the diary.</p></li>
<li><p><strong>name</strong> (<em>str, optional</em>) – the name of the instantiation of the Ditras model. The default value is “Ditras”.</p></li>
<li><p><strong>rho</strong> (<em>float, optional</em>) – it corresponds to the parameter <span class="math notranslate nohighlight">\(\rho \in (0, 1]\)</span> in the Action selection mechanism  of the DensityEPR model <span class="math notranslate nohighlight">\(P_{new} = \rho S^{-\gamma}\)</span> and controls the agent’s tendency to explore a new location during the next move versus returning to a previously visited location. The default value is <span class="math notranslate nohighlight">\(\rho = 0.6\)</span> <a class="reference internal" href="#skwb2010" id="id8"><span>[SKWB2010]</span></a>.</p></li>
<li><p><strong>gamma</strong> (<em>float, optional</em>) – it corresponds to the parameter <span class="math notranslate nohighlight">\(\gamma\)</span> (<span class="math notranslate nohighlight">\(\gamma \geq 0\)</span>) in the Action selection mechanism of the DensityEPR model <span class="math notranslate nohighlight">\(P_{new} = \rho S^{-\gamma}\)</span> and controls the agent’s tendency to explore a new location during the next move versus returning to a previously visited location. The default value is <span class="math notranslate nohighlight">\(\gamma=0.21\)</span> <a class="reference internal" href="#skwb2010" id="id9"><span>[SKWB2010]</span></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Variables</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>diary_generator</strong> (<a class="reference internal" href="#skmob.models.markov_diary_generator.MarkovDiaryGenerator" title="skmob.models.markov_diary_generator.MarkovDiaryGenerator"><em>MarkovDiaryGenerator</em></a>) – the diary generator to use for generating the diary <a class="reference internal" href="#id21" id="id10"><span>[PS2018]</span></a>.</p></li>
<li><p><strong>name</strong> (<em>str</em>) – the name of the instantiation of the model.</p></li>
<li><p><strong>rho</strong> (<em>float</em>) – the input parameter <span class="math notranslate nohighlight">\(\rho\)</span>.</p></li>
<li><p><strong>gamma</strong> (<em>float</em>) – the input parameters <span class="math notranslate nohighlight">\(\gamma\)</span>.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">skmob</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.models.epr</span> <span class="kn">import</span> <span class="n">Ditras</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.models.markov_diary_generator</span> <span class="kn">import</span> <span class="n">MarkovDiaryGenerator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.preprocessing</span> <span class="kn">import</span> <span class="n">filtering</span><span class="p">,</span> <span class="n">compression</span><span class="p">,</span> <span class="n">detection</span><span class="p">,</span> <span class="n">clustering</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># load and preprocess data to train the MarkovDiaryGenerator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="n">skmob</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">GEOLIFE_SAMPLE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tdf</span> <span class="o">=</span> <span class="n">skmob</span><span class="o">.</span><span class="n">TrajDataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ctdf</span> <span class="o">=</span> <span class="n">compression</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">tdf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stdf</span> <span class="o">=</span> <span class="n">detection</span><span class="o">.</span><span class="n">stops</span><span class="p">(</span><span class="n">ctdf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cstdf</span> <span class="o">=</span> <span class="n">clustering</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">stdf</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># instantiate and train the MarkovDiaryGenerator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mdg</span> <span class="o">=</span> <span class="n">MarkovDiaryGenerator</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mdg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cstdf</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">lid</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># set start time, end time and tessellation for the simulation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">start_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2019/01/01 08:00:00&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">end_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2019/01/14 08:00:00&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tessellation</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;data/NY_counties_2011.geojson&quot;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># instantiate the model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ditras</span> <span class="o">=</span> <span class="n">Ditras</span><span class="p">(</span><span class="n">mdg</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># run the model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ditras_tdf</span> <span class="o">=</span> <span class="n">ditras</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">tessellation</span><span class="p">,</span> <span class="n">relevance_column</span><span class="o">=</span><span class="s1">&#39;population&#39;</span><span class="p">,</span>
<span class="go">                n_agents=3, od_matrix=None, show_progress=True)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ditras_tdf</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">   uid            datetime        lat        lng</span>
<span class="go">0    1 2019-01-01 08:00:00  43.382528 -78.230656</span>
<span class="go">1    1 2019-01-02 03:00:00  43.309133 -77.680414</span>
<span class="go">2    1 2019-01-02 23:00:00  43.382528 -78.230656</span>
<span class="go">3    1 2019-01-03 10:00:00  43.382528 -78.230656</span>
<span class="go">4    1 2019-01-03 21:00:00  43.309133 -77.680414</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ditras_tdf</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
<span class="go">{&#39;model&#39;: {&#39;class&#39;: &lt;function Ditras.__init__ at 0x7f0cf0b7e158&gt;, &#39;generate&#39;: {&#39;start_date&#39;: Timestamp(&#39;2019-01-01 08:00:00&#39;), &#39;end_date&#39;: Timestamp(&#39;2019-01-14 08:00:00&#39;), &#39;gravity_singly&#39;: {}, &#39;n_agents&#39;: 3, &#39;relevance_column&#39;: &#39;population&#39;, &#39;random_state&#39;: None, &#39;show_progress&#39;: True}}}</span>
</pre></div>
</div>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="ps2018"><span class="brackets">PS2018</span></dt>
<dd><p>Pappalardo, L. &amp; Simini, F. (2018) Data-driven generation of spatio-temporal routines in human mobility. Data Mining and Knowledge Discovery 32, 787-829, <a class="reference external" href="https://link.springer.com/article/10.1007/s10618-017-0548-4">https://link.springer.com/article/10.1007/s10618-017-0548-4</a></p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#skmob.models.epr.DensityEPR" title="skmob.models.epr.DensityEPR"><code class="xref py py-obj docutils literal notranslate"><span class="pre">DensityEPR</span></code></a>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">MarkovDiaryGenerator</span></code></p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="skmob.models.epr.Ditras.generate">
<span class="sig-name descname"><span class="pre">generate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spatial_tessellation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gravity_singly</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_agents</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">starting_locations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">od_matrix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">relevance_column</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'relevance'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_progress</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.epr.Ditras.generate" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the simulation of a set of agents at time <cite>start_date</cite> till time <cite>end_date</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_date</strong> (<em>datetime</em>) – the starting date of the simulation, in “YYY/mm/dd HH:MM:SS” format.</p></li>
<li><p><strong>end_date</strong> (<em>datetime</em>) – the ending date of the simulation, in “YYY/mm/dd HH:MM:SS” format.</p></li>
<li><p><strong>spatial_tessellation</strong> (<em>geopandas GeoDataFrame</em>) – the spatial tessellation, i.e., a division of the territory in locations.</p></li>
<li><p><strong>gravity_singly</strong> (<em>{} or Gravity, optional</em>) – the (singly constrained) gravity model to use when generating the probability to move between two locations. The default is “{}”.</p></li>
<li><p><strong>n_agents</strong> (<em>int, optional</em>) – the number of agents to generate. The default is 1.</p></li>
<li><p><strong>starting_locations</strong> (<em>list or None, optional</em>) – a list of integers, each identifying the location from which to start the simulation of each agent. Note that, if <cite>starting_locations</cite> is not None, its length must be equal to the value of <cite>n_agents</cite>, i.e., you must specify one starting location per agent. The default is None.</p></li>
<li><p><strong>od_matrix</strong> (<em>numpy array or None, optional</em>) – the origin destination matrix to use for deciding the movements of the agent (element [i,j] is the probability of one trip from location with tessellation index i to j, normalized by origin location). If <cite>None</cite>, it is computed “on the fly” during the simulation. The default is None.</p></li>
<li><p><strong>relevance_column</strong> (<em>str, optional</em>) – the name of the column in <cite>spatial_tessellation</cite> to use as relevance variable. The default is “relevance”.</p></li>
<li><p><strong>random_state</strong> (<em>int or None, optional</em>) – if int, it is the seed used by the random number generator; if None, the random number generator is the RandomState instance used by np.random and random.random. The default is None.</p></li>
<li><p><strong>log_file</strong> (<em>str or None, optional</em>) – the name of the file where to write a log of the execution of the model. The logfile will contain all decisions (returns or explorations) made by the model. The default is None.</p></li>
<li><p><strong>show_progress</strong> (<em>boolean, optional</em>) – if True, show a progress bar. The default is False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the synthetic trajectories generated by the model</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="data_structures.html#skmob.core.trajectorydataframe.TrajDataFrame" title="skmob.core.trajectorydataframe.TrajDataFrame">TrajDataFrame</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="skmob.models.epr.SpatialEPR">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">skmob.models.epr.</span></span><span class="sig-name descname"><span class="pre">SpatialEPR</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Spatial</span> <span class="pre">EPR</span> <span class="pre">model'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rho</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.21</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">17</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_wait_time_minutes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.epr.SpatialEPR" title="Permalink to this definition">¶</a></dt>
<dd><p>Spatial-EPR model.</p>
<p>The s-EPR model of individual human mobility consists of the following mechanisms <a class="reference internal" href="#psrpgb2015" id="id11"><span>[PSRPGB2015]</span></a> <a class="reference internal" href="#psr2016" id="id12"><span>[PSR2016]</span></a> <a class="reference internal" href="#skwb2010" id="id13"><span>[SKWB2010]</span></a>:</p>
<p><strong>Waiting time choice</strong>. The waiting time <span class="math notranslate nohighlight">\(\Delta t\)</span> between two movements of the agent is chosen randomly from the distribution <span class="math notranslate nohighlight">\(P(\Delta t) \sim \Delta t^{−1 −\beta} \exp(−\Delta t/ \tau)\)</span>. Parameters <span class="math notranslate nohighlight">\(\beta\)</span> and <span class="math notranslate nohighlight">\(\tau\)</span> correspond to arguments <cite>beta</cite> and <cite>tau</cite> of the constructor, respectively.</p>
<p><strong>Action selection</strong>. With probability <span class="math notranslate nohighlight">\(P_{new}=\rho S^{-\gamma}\)</span>, where <span class="math notranslate nohighlight">\(S\)</span> is the number of distinct locations previously visited by the agent, the agent visits a new location (Exploration phase), otherwise it returns to a previously visited location (Return phase). Parameters <span class="math notranslate nohighlight">\(\rho\)</span> and <span class="math notranslate nohighlight">\(\gamma\)</span> correspond to arguments <cite>rho</cite> and <cite>gamma</cite> of the constructor, respectively.</p>
<p><strong>Exploration phase</strong>. If the agent that is currently in location <span class="math notranslate nohighlight">\(i\)</span> explores a new location, then the new location <span class="math notranslate nohighlight">\(j \neq i\)</span> is selected according to the distance from the current location <span class="math notranslate nohighlight">\(p_{ij} = \frac{1}{r_{ij}^2}\)</span>, where <span class="math notranslate nohighlight">\(r_{ij}\)</span> is the geographic distance between <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span>. The number of distinct locations visited, <span class="math notranslate nohighlight">\(S\)</span>, is increased by 1.</p>
<p><strong>Return phase</strong>. If the individual returns to a previously visited location, such a location <span class="math notranslate nohighlight">\(i\)</span> is chosen with probability proportional to the number of time the agent visited <span class="math notranslate nohighlight">\(i\)</span>, i.e., <span class="math notranslate nohighlight">\(\Pi_i = f_i\)</span>, where <span class="math notranslate nohighlight">\(f_i\)</span> is the visitation frequency of location <span class="math notranslate nohighlight">\(i\)</span>.</p>
<img alt="https://media.springernature.com/full/springer-static/image/art%3A10.1038%2Fnphys1760/MediaObjects/41567_2010_Article_BFnphys1760_Fig2_HTML.jpg?as=webp" src="https://media.springernature.com/full/springer-static/image/art%3A10.1038%2Fnphys1760/MediaObjects/41567_2010_Article_BFnphys1760_Fig2_HTML.jpg?as=webp" />
<p>Starting at time <span class="math notranslate nohighlight">\(t\)</span> from the configuration shown in the left panel, indicating that the user visited previously <span class="math notranslate nohighlight">\(S=4\)</span> locations with frequency <span class="math notranslate nohighlight">\(f_i\)</span> that is proportional to the size of circles drawn at each location, at time <span class="math notranslate nohighlight">\(t + \Delta t\)</span> (with <span class="math notranslate nohighlight">\(Delta t\)</span> drawn from the <span class="math notranslate nohighlight">\(P(\Delta t)\)</span> fat-tailed distribution) the user can either visit a new location at distance <span class="math notranslate nohighlight">\(\Delta r\)</span> from his/her present location, or return to a previously visited location with probability <span class="math notranslate nohighlight">\(P_{ret}=\rho S^{-\gamma}\)</span>, where the next location will be chosen with probability <span class="math notranslate nohighlight">\(\Pi_i=f_i\)</span> (preferential return; lower panel). Figure from <a class="reference internal" href="#skwb2010" id="id14"><span>[SKWB2010]</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>str, optional</em>) – the name of the instantiation of the s-EPR model. The default value is “Spatial EPR model”.</p></li>
<li><p><strong>rho</strong> (<em>float, optional</em>) – it corresponds to the parameter <span class="math notranslate nohighlight">\(\rho \in (0, 1]\)</span> in the Action selection mechanism <span class="math notranslate nohighlight">\(P_{new} = \rho S^{-\gamma}\)</span> and controls the agent’s tendency to explore a new location during the next move versus returning to a previously visited location. The default value is <span class="math notranslate nohighlight">\(\rho = 0.6\)</span> <a class="reference internal" href="#skwb2010" id="id15"><span>[SKWB2010]</span></a>.</p></li>
<li><p><strong>gamma</strong> (<em>float, optional</em>) – it corresponds to the parameter <span class="math notranslate nohighlight">\(\gamma\)</span> (<span class="math notranslate nohighlight">\(\gamma \geq 0\)</span>) in the Action selection mechanism <span class="math notranslate nohighlight">\(P_{new} = \rho S^{-\gamma}\)</span> and controls the agent’s tendency to explore a new location during the next move versus returning to a previously visited location. The default value is <span class="math notranslate nohighlight">\(\gamma=0.21\)</span> <a class="reference internal" href="#skwb2010" id="id16"><span>[SKWB2010]</span></a>.</p></li>
<li><p><strong>beta</strong> (<em>float, optional</em>) – it corresponds to the parameter <span class="math notranslate nohighlight">\(\beta\)</span> of the waiting time distribution in the Waiting time choice mechanism. The default value is <span class="math notranslate nohighlight">\(\beta=0.8\)</span> <a class="reference internal" href="#skwb2010" id="id17"><span>[SKWB2010]</span></a>.</p></li>
<li><p><strong>tau</strong> (<em>int, optional</em>) – it corresponds to the parameter <span class="math notranslate nohighlight">\(\tau\)</span> of the waiting time distribution in the Waiting time choice mechanism. The default value is <span class="math notranslate nohighlight">\(\tau = 17\)</span>, expressed in hours <a class="reference internal" href="#skwb2010" id="id18"><span>[SKWB2010]</span></a>.</p></li>
<li><p><strong>min_wait_time_minutes</strong> (<em>int</em>) – the input parameters <cite>min_wait_time_minutes</cite></p></li>
</ul>
</dd>
<dt class="field-even">Variables</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – the name of the instantiation of the model.</p></li>
<li><p><strong>rho</strong> (<em>float</em>) – the input parameter <span class="math notranslate nohighlight">\(\rho\)</span>.</p></li>
<li><p><strong>gamma</strong> (<em>float</em>) – the input parameters <span class="math notranslate nohighlight">\(\gamma\)</span>.</p></li>
<li><p><strong>beta</strong> (<em>float</em>) – the input parameter <span class="math notranslate nohighlight">\(\beta\)</span>.</p></li>
<li><p><strong>tau</strong> (<em>int</em>) – the input parameter <span class="math notranslate nohighlight">\(\tau\)</span>.</p></li>
<li><p><strong>min_wait_time_minutes</strong> (<em>int</em>) – the input parameters <cite>min_wait_time_minutes</cite>.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">skmob</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.models.epr</span> <span class="kn">import</span> <span class="n">SpatialEPR</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">url</span> <span class="o">=</span> <span class="n">skmob</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">NY_COUNTIES_2011</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tessellation</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">start_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2019/01/01 08:00:00&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">end_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2019/01/14 08:00:00&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sepr</span> <span class="o">=</span> <span class="n">SpatialEPR</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tdf</span> <span class="o">=</span> <span class="n">sepr</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">tessellation</span><span class="p">,</span> <span class="n">n_agents</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">tdf</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">   uid                   datetime        lat        lng</span>
<span class="go">0    1 2019-01-01 08:00:00.000000  42.267915 -77.383591</span>
<span class="go">1    1 2019-01-01 13:06:13.973868  42.633510 -77.105324</span>
<span class="go">2    1 2019-01-01 14:17:41.188668  42.452018 -76.473618</span>
<span class="go">3    1 2019-01-01 14:49:30.896248  42.633510 -77.105324</span>
<span class="go">4    1 2019-01-01 15:10:54.133150  43.382528 -78.230656</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">tdf</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
<span class="go">{&#39;model&#39;: {&#39;class&#39;: &lt;function SpatialEPR.__init__ at 0x7f548a49e048&gt;, &#39;generate&#39;: {&#39;start_date&#39;: Timestamp(&#39;2019-01-01 08:00:00&#39;), &#39;end_date&#39;: Timestamp(&#39;2019-01-14 08:00:00&#39;), &#39;gravity_singly&#39;: {}, &#39;n_agents&#39;: 100, &#39;relevance_column&#39;: None, &#39;random_state&#39;: None, &#39;show_progress&#39;: True}}}</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">EPR</span></code>, <a class="reference internal" href="#skmob.models.epr.DensityEPR" title="skmob.models.epr.DensityEPR"><code class="xref py py-obj docutils literal notranslate"><span class="pre">DensityEPR</span></code></a>, <a class="reference internal" href="#skmob.models.epr.Ditras" title="skmob.models.epr.Ditras"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Ditras</span></code></a></p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="skmob.models.epr.SpatialEPR.generate">
<span class="sig-name descname"><span class="pre">generate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spatial_tessellation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gravity_singly</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_agents</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">starting_locations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">od_matrix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_progress</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.epr.SpatialEPR.generate" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the simulation of a set of agents at time <cite>start_date</cite> till time <cite>end_date</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_date</strong> (<em>datetime</em>) – the starting date of the simulation, in “YYY/mm/dd HH:MM:SS” format.</p></li>
<li><p><strong>end_date</strong> (<em>datetime</em>) – the ending date of the simulation, in “YYY/mm/dd HH:MM:SS” format.</p></li>
<li><p><strong>spatial_tessellation</strong> (<em>geopandas GeoDataFrame</em>) – the spatial tessellation, i.e., a division of the territory in locations.</p></li>
<li><p><strong>gravity_singly</strong> (<em>{} or Gravity, optional</em>) – the gravity model (singly constrained) to use when generating the probability to move between two locations (note, used by DensityEPR). The default is “{}”.</p></li>
<li><p><strong>n_agents</strong> (<em>int, optional</em>) – the number of agents to generate. The default is 1.</p></li>
<li><p><strong>starting_locations</strong> (<em>list or None, optional</em>) – a list of integers, each identifying the location from which to start the simulation of each agent. Note that, if <cite>starting_locations</cite> is not None, its length must be equal to the value of <cite>n_agents</cite>, i.e., you must specify one starting location per agent. The default is None.</p></li>
<li><p><strong>od_matrix</strong> (<em>numpy array or None, optional</em>) – the origin destination matrix to use for deciding the movements of the agent (element [i,j] is the probability of one trip from location with tessellation index i to j, normalized by origin location). If <cite>None</cite>, it is computed “on the fly” during the simulation. The default is None.</p></li>
<li><p><strong>random_state</strong> (<em>int or None, optional</em>) – if int, it is the seed used by the random number generator; if None, the random number generator is the RandomState instance used by np.random and random.random. The default is None.</p></li>
<li><p><strong>log_file</strong> (<em>str or None, optional</em>) – the name of the file where to write a log of the execution of the model. The logfile will contain all decisions (returns or explorations) made by the model. The default is None.</p></li>
<li><p><strong>show_progress</strong> (<em>boolean, optional</em>) – if True, show a progress bar. The default is False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the synthetic trajectories generated by the model</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="data_structures.html#skmob.core.trajectorydataframe.TrajDataFrame" title="skmob.core.trajectorydataframe.TrajDataFrame">TrajDataFrame</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-skmob.models.markov_diary_generator">
<span id="markov-diary-generator"></span><h2>Markov Diary Generator<a class="headerlink" href="#module-skmob.models.markov_diary_generator" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="skmob.models.markov_diary_generator.MarkovDiaryGenerator">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">skmob.models.markov_diary_generator.</span></span><span class="sig-name descname"><span class="pre">MarkovDiaryGenerator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Markov</span> <span class="pre">diary'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.markov_diary_generator.MarkovDiaryGenerator" title="Permalink to this definition">¶</a></dt>
<dd><p>Markov Diary Learner and Generator.</p>
<p>A diary generator <span class="math notranslate nohighlight">\(G\)</span> produces a mobility diary, <span class="math notranslate nohighlight">\(D(t)\)</span>, containing the sequence of trips made by an agent during a time period divided in time slots of <span class="math notranslate nohighlight">\(t\)</span> seconds. For example, <span class="math notranslate nohighlight">\(G(3600)\)</span> and <span class="math notranslate nohighlight">\(G(60)\)</span> produce mobility diaries with temporal resolutions of one hour and one minute, respectively <a class="reference internal" href="#id21" id="id19"><span>[PS2018]</span></a>.</p>
<p>A Mobility Diary Learner (MDL) is a data-driven algorithm to compute a mobility diary <span class="math notranslate nohighlight">\(MD\)</span> from the mobility trajectories of a set of real individuals. We use a Markov model to describe the probability that an individual follows her routine and visits a typical location at the usual time, or she breaks the routine and visits another location. First, MDL translates mobility trajectory data of real individuals into abstract mobility trajectories. Second, it uses the obtained abstract trajectory data to compute the transition probabilities of the Markov model <span class="math notranslate nohighlight">\(MD(t)\)</span> <a class="reference internal" href="#id21" id="id20"><span>[PS2018]</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> (<em>str, optional</em>) – name of the instantiation of the class. The default is “Markov diary”.</p>
</dd>
<dt class="field-even">Variables</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – name of the instantiation of the class.</p></li>
<li><p><strong>markov_chain_</strong> (<em>dict</em>) – the trained markov chain.</p></li>
<li><p><strong>time_slot_length</strong> (<em>str</em>) – length of the time slot (1h).</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">skmob</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.models.epr</span> <span class="kn">import</span> <span class="n">Ditras</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.models.markov_diary_generator</span> <span class="kn">import</span> <span class="n">MarkovDiaryGenerator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.preprocessing</span> <span class="kn">import</span> <span class="n">filtering</span><span class="p">,</span> <span class="n">compression</span><span class="p">,</span> <span class="n">detection</span><span class="p">,</span> <span class="n">clustering</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="n">skmob</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">GEOLIFE_SAMPLE</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tdf</span> <span class="o">=</span> <span class="n">skmob</span><span class="o">.</span><span class="n">TrajDataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ctdf</span> <span class="o">=</span> <span class="n">compression</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">tdf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stdf</span> <span class="o">=</span> <span class="n">detection</span><span class="o">.</span><span class="n">stops</span><span class="p">(</span><span class="n">ctdf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cstdf</span> <span class="o">=</span> <span class="n">clustering</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">stdf</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mdg</span> <span class="o">=</span> <span class="n">MarkovDiaryGenerator</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mdg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cstdf</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">lid</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">start_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2019/01/01 08:00:00&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diary</span> <span class="o">=</span> <span class="n">mdg</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">diary</span><span class="p">)</span>
<span class="go">             datetime  abstract_location</span>
<span class="go">0 2019-01-01 08:00:00                  0</span>
<span class="go">1 2019-01-02 19:00:00                  1</span>
<span class="go">2 2019-01-02 20:00:00                  0</span>
<span class="go">3 2019-01-03 17:00:00                  1</span>
<span class="go">4 2019-01-03 18:00:00                  2</span>
<span class="go">5 2019-01-04 08:00:00                  0</span>
<span class="go">6 2019-01-05 03:00:00                  1</span>
</pre></div>
</div>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="id21"><span class="brackets">PS2018</span></dt>
<dd><p>Pappalardo, L. &amp; Simini, F. (2018) Data-driven generation of spatio-temporal routines in human mobility. Data Mining and Knowledge Discovery 32, 787-829, <a class="reference external" href="https://link.springer.com/article/10.1007/s10618-017-0548-4">https://link.springer.com/article/10.1007/s10618-017-0548-4</a></p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Ditras</span></code></p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="skmob.models.markov_diary_generator.MarkovDiaryGenerator.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">traj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_individuals</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'location'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.markov_diary_generator.MarkovDiaryGenerator.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Train the markov mobility diary from real trajectories.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>traj</strong> (<em>TrajDataFrame</em>) – the trajectories of the individuals.</p></li>
<li><p><strong>n_individuals</strong> (<em>int</em>) – the number of individuals in the TrajDataFrame to consider.</p></li>
<li><p><strong>lid</strong> (<em>string, optional</em>) – the name of the column containing the identifier of the location. The default is “location”.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="skmob.models.markov_diary_generator.MarkovDiaryGenerator.generate">
<span class="sig-name descname"><span class="pre">generate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">diary_length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.markov_diary_generator.MarkovDiaryGenerator.generate" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the generation of the mobility diary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>diary_length</strong> (<em>int</em>) – the length of the diary in hours.</p></li>
<li><p><strong>start_date</strong> (<em>datetime</em>) – the starting date of the generation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the generated mobility diary.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pandas DataFrame</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-skmob.models.gravity">
<span id="gravity"></span><h2>Gravity<a class="headerlink" href="#module-skmob.models.gravity" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="skmob.models.gravity.Gravity">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">skmob.models.gravity.</span></span><span class="sig-name descname"><span class="pre">Gravity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">deterrence_func_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'power_law'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deterrence_func_args</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[-</span> <span class="pre">2.0]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">origin_exp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">destination_exp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gravity_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'singly</span> <span class="pre">constrained'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Gravity</span> <span class="pre">model'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.gravity.Gravity" title="Permalink to this definition">¶</a></dt>
<dd><p>Gravity model.</p>
<p>The Gravity model of human migration. In its original formulation, the probability <span class="math notranslate nohighlight">\(T_{ij}\)</span> of moving from a location <span class="math notranslate nohighlight">\(i\)</span> to location <span class="math notranslate nohighlight">\(j\)</span> is defined as <a class="reference internal" href="#z1946" id="id22"><span>[Z1946]</span></a>:</p>
<div class="math notranslate nohighlight">
\[T_{ij} \propto \frac{P_i P_j}{r_{ij}}\]</div>
<p>where <span class="math notranslate nohighlight">\(P_i\)</span> and <span class="math notranslate nohighlight">\(P_j\)</span> are the population of location <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span> and <span class="math notranslate nohighlight">\(r_{ij}\)</span> is the distance between <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span>. The basic assumptions of this model are that the number of trips leaving location <span class="math notranslate nohighlight">\(i\)</span> is proportional to its population <span class="math notranslate nohighlight">\(P_i\)</span>, the attractivity of location <span class="math notranslate nohighlight">\(j\)</span> is also proportional to <span class="math notranslate nohighlight">\(P_j\)</span>, and finally, that there is a cost effect in terms of distance traveled. These ideas can be generalized assuming a relation of the type <a class="reference internal" href="#bbgjllmrst2018" id="id23"><span>[BBGJLLMRST2018]</span></a>:</p>
<div class="math notranslate nohighlight">
\[T_{ij} = K m_i m_j f(r_{ij})\]</div>
<p>where <span class="math notranslate nohighlight">\(K\)</span> is a constant, the masses <span class="math notranslate nohighlight">\(m_i\)</span> and <span class="math notranslate nohighlight">\(m_j\)</span> relate to the number of trips leaving location <span class="math notranslate nohighlight">\(i\)</span> or the ones attracted by location <span class="math notranslate nohighlight">\(j\)</span>, and <span class="math notranslate nohighlight">\(f(r_{ij})\)</span>, called <em>deterrence function</em>, is a decreasing function of distance. The deterrence function <span class="math notranslate nohighlight">\(f(r_{ij})\)</span> is commonly modeled with a powerlaw or an exponential form.</p>
<p><strong>Constrained gravity models</strong>. Some of the limitations of the gravity model can be resolved via constrained versions. For example, one may hold the number of people originating from a location <span class="math notranslate nohighlight">\(i\)</span> to be a known quantity <span class="math notranslate nohighlight">\(O_i\)</span>, and the gravity model is then used to estimate the destination, constituting a so-called <em>singly constrained</em> gravity model of the form:</p>
<div class="math notranslate nohighlight">
\[T_{ij} = K_i O_i m_j f(r_{ij}) = O_i \frac{m_i f(r_{ij})}{\sum_k m_k f(r_{ik})}.\]</div>
<p>In this formulation, the proportionality constants <span class="math notranslate nohighlight">\(K_i\)</span> depend on the location of the origin and its distance to the other places considered. We can fix also the total number of travelers arriving at a destination <span class="math notranslate nohighlight">\(j\)</span> as <span class="math notranslate nohighlight">\(D_j = \sum_i T_{ij}\)</span>, leading to a <em>doubly-constrained</em> gravity model. For each origin-destination pair, the flow is calculated as:</p>
<div class="math notranslate nohighlight">
\[T_{ij} = K_i O_i L_j D_j f(r_{ij})\]</div>
<p>where there are now two flavors of proportionality constants</p>
<div class="math notranslate nohighlight">
\[K_i = \frac{1}{\sum_j L_j D_j f(r_{ij})}, L_j = \frac{1}{\sum_i K_i O_i f(r_{ij})}.\]</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>deterrence_func_type</strong> (<em>str, optional</em>) – the deterrence function to use. The possible deterrence function are “power_law” and “exponential”. The default is “power_law”.</p></li>
<li><p><strong>deterrence_func_args</strong> (<em>list, optional</em>) – the arguments of the deterrence function. The default is [-2.0].</p></li>
<li><p><strong>origin_exp</strong> (<em>float, optional</em>) – the exponent of the origin’s relevance (only relevant to globally-constrained model). The default is <cite>1.0</cite>.</p></li>
<li><p><strong>destination_exp</strong> (<em>float, optional</em>) – the explonent of the destination’s relevance. The default is 1.0.</p></li>
<li><p><strong>gravity_type</strong> (<em>str, optional</em>) – the type of gravity model. Possible values are “singly constrained” and “globally constrained”. The default is “singly constrained”.</p></li>
<li><p><strong>name</strong> (<em>str, optional</em>) – the name of the instantiation of the Gravity model. The default is “Gravity model”.</p></li>
</ul>
</dd>
<dt class="field-even">Variables</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>deterrence_func_type</strong> (<em>str</em>) – the deterrence function to use. The possible deterrence function are “power_law” and “exponential”.</p></li>
<li><p><strong>deterrence_func_args</strong> (<em>list</em>) – the arguments of the deterrence function.</p></li>
<li><p><strong>origin_exp</strong> (<em>float</em>) – the exponent of the origin’s relevance (only relevant to globally-constrained model).</p></li>
<li><p><strong>destination_exp</strong> (<em>float</em>) – the explonent of the destination’s relevance.</p></li>
<li><p><strong>gravity_type</strong> (<em>str</em>) – the type of gravity model. Possible values are “singly constrained” and “globally constrained”.</p></li>
<li><p><strong>name</strong> (<em>str</em>) – the name of the instantiation of the Gravity model.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">skmob</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.utils</span> <span class="kn">import</span> <span class="n">utils</span><span class="p">,</span> <span class="n">constants</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.models</span> <span class="kn">import</span> <span class="n">Gravity</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># load a spatial tessellation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url_tess</span> <span class="o">=</span> <span class="n">skmob</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">NY_COUNTIES_2011</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tessellation</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">url_tess</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;tile_id&#39;</span><span class="p">:</span> <span class="s1">&#39;tile_ID&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">tessellation</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">  tile_ID  population                                           geometry</span>
<span class="go">0   36019       81716  POLYGON ((-74.006668 44.886017, -74.027389 44....</span>
<span class="go">1   36101       99145  POLYGON ((-77.099754 42.274215, -77.0996569999...</span>
<span class="go">2   36107       50872  POLYGON ((-76.25014899999999 42.296676, -76.24...</span>
<span class="go">3   36059     1346176  POLYGON ((-73.707662 40.727831, -73.700272 40....</span>
<span class="go">4   36011       79693  POLYGON ((-76.279067 42.785866, -76.2753479999...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># load real flows into a FlowDataFrame</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fdf</span> <span class="o">=</span> <span class="n">skmob</span><span class="o">.</span><span class="n">FlowDataFrame</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">skmob</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">NY_FLOWS_2011</span><span class="p">,</span>
<span class="go">                                        tessellation=tessellation,</span>
<span class="go">                                        tile_id=&#39;tile_ID&#39;,</span>
<span class="go">                                        sep=&quot;,&quot;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fdf</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">     flow origin destination</span>
<span class="go">0  121606  36001       36001</span>
<span class="go">1       5  36001       36005</span>
<span class="go">2      29  36001       36007</span>
<span class="go">3      11  36001       36017</span>
<span class="go">4      30  36001       36019</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># compute the total outflows from each location of the tessellation (excluding self loops)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tot_outflows</span> <span class="o">=</span> <span class="n">fdf</span><span class="p">[</span><span class="n">fdf</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">fdf</span><span class="p">[</span><span class="s1">&#39;destination&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;origin&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[[</span><span class="s1">&#39;flow&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tessellation</span> <span class="o">=</span> <span class="n">tessellation</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tot_outflows</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;tile_ID&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;origin&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;flow&#39;</span><span class="p">:</span> <span class="n">constants</span><span class="o">.</span><span class="n">TOT_OUTFLOW</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">tessellation</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">  tile_id  population                                           geometry      0   36019       81716  POLYGON ((-74.006668 44.886017, -74.027389 44....</span>
<span class="go">1   36101       99145  POLYGON ((-77.099754 42.274215, -77.0996569999...</span>
<span class="go">2   36107       50872  POLYGON ((-76.25014899999999 42.296676, -76.24...</span>
<span class="go">3   36059     1346176  POLYGON ((-73.707662 40.727831, -73.700272 40....</span>
<span class="go">4   36011       79693  POLYGON ((-76.279067 42.785866, -76.2753479999...</span>
<span class="go">   tot_outflow</span>
<span class="go">0        29981</span>
<span class="go">1         5319</span>
<span class="go">2       295916</span>
<span class="go">3         8665</span>
<span class="go">4         8871</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># instantiate a singly constrained Gravity model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gravity_singly</span> <span class="o">=</span> <span class="n">Gravity</span><span class="p">(</span><span class="n">gravity_type</span><span class="o">=</span><span class="s1">&#39;singly constrained&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">gravity_singly</span><span class="p">)</span>
<span class="go">Gravity(name=&quot;Gravity model&quot;, deterrence_func_type=&quot;power_law&quot;, deterrence_func_args=[-2.0], origin_exp=1.0, destination_exp=1.0, gravity_type=&quot;singly constrained&quot;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">synth_fdf</span> <span class="o">=</span> <span class="n">gravity_singly</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">tessellation</span><span class="p">,</span>
<span class="go">                                   tile_id_column=&#39;tile_ID&#39;,</span>
<span class="go">                                   tot_outflows_column=&#39;tot_outflow&#39;,</span>
<span class="go">                                   relevance_column= &#39;population&#39;,</span>
<span class="go">                                   out_format=&#39;flows&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">synth_fdf</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">  origin destination  flow</span>
<span class="go">0  36019       36101   101</span>
<span class="go">1  36019       36107    66</span>
<span class="go">2  36019       36059  1041</span>
<span class="go">3  36019       36011   151</span>
<span class="go">4  36019       36123    33</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># fit the parameters of the Gravity model from real fluxes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gravity_singly_fitted</span> <span class="o">=</span> <span class="n">Gravity</span><span class="p">(</span><span class="n">gravity_type</span><span class="o">=</span><span class="s1">&#39;singly constrained&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">gravity_singly_fitted</span><span class="p">)</span>
<span class="go">Gravity(name=&quot;Gravity model&quot;, deterrence_func_type=&quot;power_law&quot;, deterrence_func_args=[-2.0], origin_exp=1.0, destination_exp=1.0, gravity_type=&quot;singly constrained&quot;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gravity_singly_fitted</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">fdf</span><span class="p">,</span> <span class="n">relevance_column</span><span class="o">=</span><span class="s1">&#39;population&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">gravity_singly_fitted</span><span class="p">)</span>
<span class="go">Gravity(name=&quot;Gravity model&quot;, deterrence_func_type=&quot;power_law&quot;, deterrence_func_args=[-1.9947152031914186], origin_exp=1.0, destination_exp=0.6471759552223144, gravity_type=&quot;singly constrained&quot;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">synth_fdf_fitted</span> <span class="o">=</span> <span class="n">gravity_singly_fitted</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">tessellation</span><span class="p">,</span>
<span class="go">                                                        tile_id_column=&#39;tile_ID&#39;,</span>
<span class="go">                                                        tot_outflows_column=&#39;tot_outflow&#39;,</span>
<span class="go">                                                        relevance_column= &#39;population&#39;,</span>
<span class="go">                                                        out_format=&#39;flows&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">synth_fdf_fitted</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">  origin destination  flow</span>
<span class="go">0  36019       36101   102</span>
<span class="go">1  36019       36107    66</span>
<span class="go">2  36019       36059  1044</span>
<span class="go">3  36019       36011   152</span>
<span class="go">4  36019       36123    33</span>
</pre></div>
</div>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="z1946"><span class="brackets"><a class="fn-backref" href="#id22">Z1946</a></span></dt>
<dd><p>Zipf, G. K. (1946) The P 1 P 2/D hypothesis: on the intercity movement of persons. American sociological review 11(6), 677-686, <a class="reference external" href="https://www.jstor.org/stable/2087063?seq=1#metadata_info_tab_contents">https://www.jstor.org/stable/2087063?seq=1#metadata_info_tab_contents</a></p>
</dd>
<dt class="label" id="w1971"><span class="brackets">W1971</span></dt>
<dd><p>Wilson, A. G. (1971) A family of spatial interaction models, and associated developments. Environment and Planning A 3(1), 1-32, <a class="reference external" href="https://econpapers.repec.org/article/pioenvira/v_3a3_3ay_3a1971_3ai_3a1_3ap_3a1-32.htm">https://econpapers.repec.org/article/pioenvira/v_3a3_3ay_3a1971_3ai_3a1_3ap_3a1-32.htm</a></p>
</dd>
<dt class="label" id="bbgjllmrst2018"><span class="brackets"><a class="fn-backref" href="#id23">BBGJLLMRST2018</a></span></dt>
<dd><p>Barbosa, H., Barthelemy, M., Ghoshal, G., James, C. R., Lenormand, M., Louail, T., Menezes, R., Ramasco, J. J. , Simini, F. &amp; Tomasini, M. (2018) Human mobility: Models and applications. Physics Reports 734, 1-74, <a class="reference external" href="https://www.sciencedirect.com/science/article/abs/pii/S037015731830022X">https://www.sciencedirect.com/science/article/abs/pii/S037015731830022X</a></p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Radiation</span></code></p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="skmob.models.gravity.Gravity.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">flow_df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">relevance_column</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'relevance'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.gravity.Gravity.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit the parameters of the Gravity model to the flows provided in input, using a Generalized Linear Model (GLM) with a Poisson regression <a class="reference internal" href="#fm1982" id="id24"><span>[FM1982]</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>flow_df</strong> (<em>FlowDataFrame</em>) – the real flows on the spatial tessellation.</p></li>
<li><p><strong>relevance_column</strong> (<em>str, optional</em>) – the column in the spatial tessellation with the relevance of the location. The default is constants.RELEVANCE.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="fm1982"><span class="brackets"><a class="fn-backref" href="#id24">FM1982</a></span></dt>
<dd><p>Flowerdew, R. &amp; Murray, A. (1982) A method of fitting the gravity model based on the Poisson distribution. Journal of regional science 22(2), 191-202, <a class="reference external" href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1467-9787.1982.tb00744.x">https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1467-9787.1982.tb00744.x</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="skmob.models.gravity.Gravity.generate">
<span class="sig-name descname"><span class="pre">generate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spatial_tessellation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tile_id_column</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'tile_ID'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tot_outflows_column</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'tot_outflow'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">relevance_column</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'relevance'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_format</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'flows'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.gravity.Gravity.generate" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the simulation of the Gravity model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spatial_tessellation</strong> (<em>GeoDataFrame</em>) – the spatial tessellation on which to run the simulation.</p></li>
<li><p><strong>tile_id_column</strong> (<em>str, optional</em>) – the column in <cite>spatial_tessellation</cite> of the location identifier. The default is <cite>constants.TILE_ID</cite>.</p></li>
<li><p><strong>tot_outflows_column</strong> (<em>str, optional</em>) – the column in <cite>spatial_tessellation</cite> with the outflow of the location. The default is <cite>constants.TOT_OUTFLOW</cite>.</p></li>
<li><p><strong>relevance_column</strong> (<em>str, optional</em>) – the column in <cite>spatial_tessellation</cite> with the relevance of the location. The default is <cite>constants.RELEVANCE</cite>.</p></li>
<li><p><strong>out_format</strong> (<em>str, optional</em>) – the format of the generated flows. Possible values are “flows” (average flow between two locations), “flows_sample” (random sample of flows), and “probabilities” (probability of a unit flow between two locations). The default is “flows”.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the flows generated by the Gravity model.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="data_structures.html#skmob.core.flowdataframe.FlowDataFrame" title="skmob.core.flowdataframe.FlowDataFrame">FlowDataFrame</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-skmob.models.radiation">
<span id="radiation"></span><h2>Radiation<a class="headerlink" href="#module-skmob.models.radiation" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="skmob.models.radiation.Radiation">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">skmob.models.radiation.</span></span><span class="sig-name descname"><span class="pre">Radiation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Radiation</span> <span class="pre">model'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.radiation.Radiation" title="Permalink to this definition">¶</a></dt>
<dd><p>Radiation model.</p>
<p>The radiation model for human migration. The radiation model assumes that the choice of a traveler’s destination consists of two steps. First, each opportunity in every location is assigned a fitness represented by a number <span class="math notranslate nohighlight">\(z\)</span>, chosen from some distribution <span class="math notranslate nohighlight">\(P(z)\)</span> whose value represents the quality of the opportunity for the traveler. Second, the traveler ranks all opportunities according to their distances from the origin location and chooses the closest opportunity with a fitness higher than the traveler’s fitness threshold, which is another random number extracted from the fitness distribution <span class="math notranslate nohighlight">\(P(z)\)</span>. As a result, the average number of travelers from location <span class="math notranslate nohighlight">\(i\)</span> to location <span class="math notranslate nohighlight">\(j\)</span> takes the form <a class="reference internal" href="#sgmb2012" id="id25"><span>[SGMB2012]</span></a>:</p>
<div class="math notranslate nohighlight">
\[T_{ij} = O_i \frac{1}{1 - \frac{m_i}{M}}\frac{m_i m_j}{(m_i + s_{ij})(m_i + m_j + s_{ij})}.\]</div>
<p>The destination of the <span class="math notranslate nohighlight">\(O_i\)</span> trips originating in <span class="math notranslate nohighlight">\(i\)</span> is sampled from a distribution of probabilities that a trip originating in <span class="math notranslate nohighlight">\(i\)</span> ends in location <span class="math notranslate nohighlight">\(j\)</span>. This probability depends on the number of opportunities at the origin <span class="math notranslate nohighlight">\(m_i\)</span>, at the destination <span class="math notranslate nohighlight">\(m_j\)</span> and the number of opportunities <span class="math notranslate nohighlight">\(s_{ij}\)</span> in a circle of radius <span class="math notranslate nohighlight">\(r_{ij}\)</span> centered in <span class="math notranslate nohighlight">\(i\)</span> (excluding the source and destination). This conditional probability needs to be normalized so that the probability that a trip originating in the region of interest ends in this region is equal to 1. In case of a finite system it is possible to show that this is equal to <span class="math notranslate nohighlight">\(1 - \frac{m_i}{M}\)</span> where <span class="math notranslate nohighlight">\(M=\sum_i m_i\)</span> is the total number of opportunities. In the original version of the radiation model, the number of opportunities is approximated by the population, but the total inflows <span class="math notranslate nohighlight">\(D_j\)</span> to each destination can also be used.</p>
<img alt="https://media.springernature.com/full/springer-static/image/art%3A10.1038%2Fnature10856/MediaObjects/41586_2012_Article_BFnature10856_Fig1_HTML.jpg?as=webp" src="https://media.springernature.com/full/springer-static/image/art%3A10.1038%2Fnature10856/MediaObjects/41586_2012_Article_BFnature10856_Fig1_HTML.jpg?as=webp" />
<p><em>(a)</em> To demonstrate the limitations of the gravity law we highlight two pairs of counties, one in Utah (UT) and the other in Alabama (AL), with similar origin (<span class="math notranslate nohighlight">\(m\)</span>, blue) and destination (<span class="math notranslate nohighlight">\(n\)</span>, green) populations and comparable distance <span class="math notranslate nohighlight">\(r\)</span> between them (see bottom left table). The US census 2000 reports a flux that is an order of magnitude greater between the Utah counties, a difference correctly captured by the radiation model <em>(b, c)</em>. <em>(b)</em> The definition of the radiation model: an individual (for example, living in Saratoga County, New York) applies for jobs in all counties and collects potential employment offers. The number of job opportunities in each county (<span class="math notranslate nohighlight">\(j\)</span>) is <span class="math notranslate nohighlight">\(n_j / n_{jobs}\)</span>, chosen to be proportional to the resident population <span class="math notranslate nohighlight">\(n_j\)</span>. Each offer’s attractiveness (benefit) is represented by a random variable with distribution <span class="math notranslate nohighlight">\(P(z)\)</span>, the numbers placed in each county representing the best offer among the <span class="math notranslate nohighlight">\(n_j / n_{jobs}\)</span> trials in that area. Each county is marked in green (red) if its best offer is better (lower) than the best offer in the home county (here <span class="math notranslate nohighlight">\(z = 10\)</span>). <em>(c)</em> An individual accepts the closest job that offers better benefits than his home county. In the shown configuration the individual will commute to Oneida County, New York, the closest county whose benefit <span class="math notranslate nohighlight">\(z = 13\)</span> exceeds the home county benefit <span class="math notranslate nohighlight">\(z = 10\)</span>. This process is repeated for each potential commuter, choosing new benefit variables <span class="math notranslate nohighlight">\(z\)</span> in each case. Figure from <a class="reference internal" href="#sgmb2012" id="id26"><span>[SGMB2012]</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> (<em>str, optional</em>) – the name of the instantiation of the radiation model. The default is ‘Radiation model’.</p>
</dd>
<dt class="field-even">Variables</dt>
<dd class="field-even"><p><strong>name</strong> (<em>str</em>) – the name of the instantiation of the model.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">skmob</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.utils</span> <span class="kn">import</span> <span class="n">utils</span><span class="p">,</span> <span class="n">constants</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.models</span> <span class="kn">import</span> <span class="n">Radiation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># load a spatial tessellation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url_tess</span> <span class="o">=</span> <span class="n">skmob</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">NY_COUNTIES_2011</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tessellation</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">url_tess</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;tile_id&#39;</span><span class="p">:</span> <span class="s1">&#39;tile_ID&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">tessellation</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">  tile_ID  population                                           geometry</span>
<span class="go">0   36019       81716  POLYGON ((-74.006668 44.886017, -74.027389 44....</span>
<span class="go">1   36101       99145  POLYGON ((-77.099754 42.274215, -77.0996569999...</span>
<span class="go">2   36107       50872  POLYGON ((-76.25014899999999 42.296676, -76.24...</span>
<span class="go">3   36059     1346176  POLYGON ((-73.707662 40.727831, -73.700272 40....</span>
<span class="go">4   36011       79693  POLYGON ((-76.279067 42.785866, -76.2753479999...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># load real flows into a FlowDataFrame</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fdf</span> <span class="o">=</span> <span class="n">skmob</span><span class="o">.</span><span class="n">FlowDataFrame</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">skmob</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">NY_FLOWS_2011</span><span class="p">,</span>
<span class="go">                                        tessellation=tessellation,</span>
<span class="go">                                        tile_id=&#39;tile_ID&#39;,</span>
<span class="go">                                        sep=&quot;,&quot;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fdf</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">     flow origin destination</span>
<span class="go">0  121606  36001       36001</span>
<span class="go">1       5  36001       36005</span>
<span class="go">2      29  36001       36007</span>
<span class="go">3      11  36001       36017</span>
<span class="go">4      30  36001       36019</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># compute the total outflows from each location of the tessellation (excluding self loops)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tot_outflows</span> <span class="o">=</span> <span class="n">fdf</span><span class="p">[</span><span class="n">fdf</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">fdf</span><span class="p">[</span><span class="s1">&#39;destination&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;origin&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[[</span><span class="s1">&#39;flow&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tessellation</span> <span class="o">=</span> <span class="n">tessellation</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tot_outflows</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;tile_ID&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;origin&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;flow&#39;</span><span class="p">:</span> <span class="n">constants</span><span class="o">.</span><span class="n">TOT_OUTFLOW</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">tessellation</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">  tile_id  population                                           geometry      0   36019       81716  POLYGON ((-74.006668 44.886017, -74.027389 44....</span>
<span class="go">1   36101       99145  POLYGON ((-77.099754 42.274215, -77.0996569999...</span>
<span class="go">2   36107       50872  POLYGON ((-76.25014899999999 42.296676, -76.24...</span>
<span class="go">3   36059     1346176  POLYGON ((-73.707662 40.727831, -73.700272 40....</span>
<span class="go">4   36011       79693  POLYGON ((-76.279067 42.785866, -76.2753479999...</span>
<span class="go">   tot_outflow</span>
<span class="go">0        29981</span>
<span class="go">1         5319</span>
<span class="go">2       295916</span>
<span class="go">3         8665</span>
<span class="go">4         8871</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">radiation</span> <span class="o">=</span> <span class="n">Radiation</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rad_flows</span> <span class="o">=</span> <span class="n">radiation</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">tessellation</span><span class="p">,</span> <span class="n">tile_id_column</span><span class="o">=</span><span class="s1">&#39;tile_ID&#39;</span><span class="p">,</span>  <span class="n">tot_outflows_column</span><span class="o">=</span><span class="s1">&#39;tot_outflow&#39;</span><span class="p">,</span> <span class="n">relevance_column</span><span class="o">=</span><span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="n">out_format</span><span class="o">=</span><span class="s1">&#39;flows_sample&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">rad_flows</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">  origin destination   flow</span>
<span class="go">0  36019       36033  11648</span>
<span class="go">1  36019       36031   4232</span>
<span class="go">2  36019       36089   5598</span>
<span class="go">3  36019       36113   1596</span>
<span class="go">4  36019       36041    117</span>
</pre></div>
</div>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="sgmb2012"><span class="brackets">SGMB2012</span><span class="fn-backref">(<a href="#id25">1</a>,<a href="#id26">2</a>)</span></dt>
<dd><p>Simini, F., Gonzàlez, M. C., Maritan, A. &amp; Barabasi, A.-L. (2012) A universal model for mobility and migration patterns. Nature 484(7392), 96-100, <a class="reference external" href="https://www.nature.com/articles/nature10856">https://www.nature.com/articles/nature10856</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="skmob.models.radiation.Radiation.generate">
<span class="sig-name descname"><span class="pre">generate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spatial_tessellation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tile_id_column</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'tile_ID'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tot_outflows_column</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'tot_outflow'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">relevance_column</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'relevance'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_format</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'flows'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.radiation.Radiation.generate" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the simulation of the Radiation model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spatial_tessellation</strong> (<em>GeoDataFrame</em>) – the spatial tessellation on which to perform the simulation.</p></li>
<li><p><strong>tile_id_column</strong> (<em>str, optional</em>) – the column in <cite>spatial_tessellation</cite> of the location identifier. The default is <cite>constants.TILE_ID</cite>.</p></li>
<li><p><strong>tot_outflows_column</strong> (<em>str, optional</em>) – the column in <cite>spatial_tessellation</cite> with the outflow of the location. The default is <cite>constants.TOT_OUTFLOW</cite>.</p></li>
<li><p><strong>relevance_column</strong> (<em>str, optional</em>) – the column in <cite>spatial_tessellation</cite> with the relevance of the location. The default is <cite>constants.RELEVANCE</cite>.</p></li>
<li><p><strong>out_format</strong> (<em>str, optional</em>) – the format of the generated flows. Possible values are: “flows” (average flow between two locations), “flows_sample” (random sample of flows), and “probabilities” (probability of a unit flow between two locations). The default is “flows”.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the fluxes generated by the Radiation model.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="data_structures.html#skmob.core.flowdataframe.FlowDataFrame" title="skmob.core.flowdataframe.FlowDataFrame">FlowDataFrame</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="io.html" class="btn btn-neutral float-right" title="Input/Output" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="evaluation_measures.html" class="btn btn-neutral float-left" title="Evaluation measures" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019, skmob devs.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>